$(function(){var e=function(e){this.pressKey=e.pressKey||0,this.playType=e.playType||"hover",this.bounceTime=e.bounceTime||1e3,this.pianoSize=e.pianoSize,this.keyGap=e.keyGap||5,this.keySize=e.keySize,this.con=e.con,this.keyImgArr=this.con.find("li"),this.pianoEle=this.con.find("ul"),this.keyArr=[],this.setup()},t=function(e){this.key=e.key,this.piano=e.piano,this.keyImg=e.keyImg,this.state=null,this.setup()};e.prototype={constructor:e,putKey:function(){for(var e=this,o=0;o<e.keyImgArr.length;o++)e.keyArr.push(new t({piano:e,key:o,keyImg:e.keyImgArr[o]}))},setPiano:function(){var e=this;e.con.append(e.pianoEle)},play:function(){for(var e=0;e<this.keyArr.length;e++)this.keyArr[e].play()},setup:function(){this.keySpace=(this.pianoSize-this.keySize)/(this.keyImgArr.length-1),this.putKey(),this.play(),this.setPiano()}},t.prototype={constructor:t,press:function(){var e=this;e.state="press",e.keyEle.stop().animate({left:e.pressPosition+"px"},500)},bounce:function(){var e=this;e.state="bounce",e.keyEle.stop().animate({left:e.bouncePosition+"px"},500)},play:function(){var e=this;e.key<=e.piano.pressKey?"bounce"!=e.state&&e.bounce():"press"!=e.state&&e.press()},setup:function(){var e=this;e.pressPosition=e.piano.keySize+(e.key-1)*e.piano.keySpace,e.bouncePosition=e.key*e.piano.keySpace,e.keyEle=$(e.keyImg),e.keyEle.on(e.piano.playType,function(){e.piano.pressKey=e.key,e.piano.play()}).appendTo(e.piano.pianoEle),0!=e.key&&(e.keyEle.css("padding-left",e.piano.keyGap+"px"),e.bouncePosition-=5)}};var o={bannerSlider:function(){for(var e,t,o=$(".banner"),n=$(".banner-slider"),i="item-active",a=4e3,l=n.find("li").length,s=$('<ol class="banner-item"></ol>'),r=0,d=function(e,t){n.find("li").eq(e).fadeOut(),r=t,n.find("li").eq(r).fadeIn(),s.find("li").removeClass(i).eq(r).addClass(i)},p=0;l>p;p++)t=$("<li></li>"),s.append(t),t.on("click",function(t){return function(){clearInterval(e),d(r,t),e=setInterval(function(){d(r,r>=l-1?0:r+1)},a)}}(p));o.append(s),s.find("li").eq(r).addClass(i),n.find("li").eq(r).show(),e=setInterval(function(){d(r,r>=l-1?0:r+1)},a)},moduleMove:function(){for(var t=0;t<$(".category-recommend-1").length;t++)new e({pianoSize:1200,keySize:700,con:$(".category-recommend-1").eq(t)})},getMore:function(e){{var t=this,o=$("#moreModule");$(".category")}t.moduleState=0,$.ajax({type:"get",url:ControllerSite+"/home/getMoreModule",data:e,contentType:"application/json",dataType:"json",success:function(n){if(n.success){for(var i,a=0;a<n.data.modules.length;a++)i=t.getModuleEle(n.data.modules[a]),o.before(i);e.pageIndex>=n.data.pageCount?o.remove():(e.pageIndex++,t.moduleState=1)}else o.html(n.error.message)},error:function(){o.html("网络请求失败！")}})},getModuleEle:function(t){var o,n,i,a,l=this;if(3!=t.moduleType){1==t.moduleType?n=$('<div class="category-recommend-1"></div>'):2==t.moduleType&&(n=$('<div class="category-recommend-2"></div>')),i=$('<div class="category-title"><dl><dt>'+t.moduleInfo.moduleTitle+"</dt></dl>"),a=$("<ul></ul>");for(var s=0;s<t.moduleInfo.moduleItems.length;s++)o=t.moduleInfo.moduleItems[s],a.append('<li><a target="_blank" href="'+l.getJumpUrl(o)+'"><img src="'+o.pcImageUrl+'"/></a></li>');n.append(i).append(a),1==t.moduleType&&new e({pianoSize:1200,keySize:700,con:n})}else{n=$('<div class="category-recommend-3"></div>'),i=$('<div class="category-title"><dl><dt>'+t.moduleInfo.moduleTitle+"</dt><dd>"+t.moduleInfo.manufacturers+"&nbsp;&nbsp;"+t.moduleInfo.moduleBrand+"</dd></dl></div>"),i.append('<a target="_blank" href="'+ControllerSite+"/classify/category.html?categoryId="+t.moduleInfo.categoryID+'">更多商品></a>'),a=$('<ul class="category-list"></ul>');for(var r=0;r<t.moduleInfo.moduleItems.length;r++)o=t.moduleInfo.moduleItems[r],a.append('<li><a target="_blank" href="'+l.getJumpUrl(o)+'"><img src="'+o.image+'"/></a><dl><dt>'+o.ext.itemName+"</dt><dd>¥"+o.ext.itemPrice+"</dd></dl></li>");n.append(i).append(a)}return n},getJumpUrl:function(e){var t;switch(Number(e.clickType)){case 1:t=window.ControllerSite+"/products/"+e.ext.suId+"-0.html";break;case 2:t=e.ext.url;break;case 3:t=window.ControllerSite+"/classify/supplier.html?supplierId="+e.ext.supplierID;break;case 4:t=window.ControllerSite+"/classify/category.html?categoryId="+e.ext.categoryID;break;case 5:t=window.ControllerSite+"/classify/saleList.html?type=1";break;case 6:t=window.ControllerSite+"/classify/saleList.html?type=2";break;case 7:t=window.ControllerSite+"/classify/newProduct.html"}return t},moduleLoad:function(){var e=$("#moreModule"),t={pageSize:10,pageIndex:2,platform:2},o=this;o.moduleState=1,e.length&&$(window).on("scroll",function(){($("body").scrollTop()||document.documentElement.scrollTop)-e.offset().top+$(window).height()>=0&&o.moduleState&&o.getMore(t)})},init:function(){this.bannerSlider(),this.moduleMove(),this.moduleLoad()}};o.init()});